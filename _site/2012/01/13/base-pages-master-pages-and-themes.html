<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Brian Scaturro - Base Pages, Master Pages, and Themes</title>
	
	<meta name="description" content="The code writing expeditions and explorations of Brian Anthony Scaturro">
	
	<meta name="author" content="Brian Scaturro">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<link href='http://fonts.googleapis.com/css?family=Anton' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" href="/css/base.css">
	<link rel="stylesheet" href="/css/skeleton.css">
	<link rel="stylesheet" href="/css/layout.css">
	<link rel="stylesheet" href="/css/pygments.css">
	<link rel="shortcut icon" href="/images/favicon.ico">
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-10808090-11']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</head>
<body>
	<div class="container">
<div class="eleven columns alpha">
	<header id="branding">
		<a href="/">
			<div class="site-heading">Brian Scaturro</div>
			<div class="site-subheading">Fancy a dance?</div>
		</a>
	</header>
	<div id="main" role="main">
		<article>
			<h1>Base Pages, Master Pages, and Themes<span class="post-date">13 Jan 2012</span></h1>
			<p>
 One aspect of ASP.NET is the concept of master pages and themes. These are two tools that are indispensable when it comes to creating a consistent look and feel for your web application. The concept of a base page will illustrate creating a consistent <code>Page</code> class for all of your web forms to inherit from. Let's do this!</p>

<p>Please feel free to download the source to get a more in depth look at the code and styles used.</p>
<p>
<a class="button add-bottom" href="/downloads/pizzagreeta.zip" title="download source">Download Source</a>
</p>
<hr />

<h2>Creating Consistent Functionality With Base Pages</h2>
<p>An important concept in any object oriented language is inheritance. C# is no exception. If you have been hackin away at some web forms lately, you should probably notice that all of your code-behind files have classes that extend the <code>System.Web.UI.Page</code> class.</p>

<div class="highlight"><pre><code class="csharp"><span class="lineno"> 1</span> <span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="lineno"> 2</span> <span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="lineno"> 3</span> <span class="k">using</span> <span class="nn">System.Linq</span><span class="p">;</span>
<span class="lineno"> 4</span> <span class="k">using</span> <span class="nn">System.Web</span><span class="p">;</span>
<span class="lineno"> 5</span> <span class="k">using</span> <span class="nn">System.Web.UI</span><span class="p">;</span>
<span class="lineno"> 6</span> <span class="k">using</span> <span class="nn">System.Web.UI.WebControls</span><span class="p">;</span>
<span class="lineno"> 7</span> 
<span class="lineno"> 8</span> <span class="k">public</span> <span class="k">partial</span> <span class="k">class</span> <span class="nc">_Default</span><span class="p">:</span> <span class="n">System</span><span class="p">.</span><span class="n">Web</span><span class="p">.</span><span class="n">UI</span><span class="p">.</span><span class="n">Page</span>
<span class="lineno"> 9</span> <span class="p">{</span>
<span class="lineno">10</span>     <span class="c1">//..methods and properties</span>
<span class="lineno">11</span> <span class="p">}</span>
</code></pre>
</div>


<p>As you can see, extension is accomplished via the colon (:).</p>

<p>The idea behind a base page is creating a class that extends the <code>System.Web.UI.Page</code> class. Instead of inheriting from the <code>System.Web.UI.Page</code> class, your pages will all inherit from the custom <code>BasePage</code> class.</p>

<h3>Creating A BasePage Class</h3>
<p>If you haven't already, and since we are working in a "Web Site" project, right click the project name in the solution explorer and follow <code>Add ASP.NET Folder > App_Code</code>.</p>

<div class="post-image"><img src="/images/app_code.jpg" alt="adding the app_code folder" title="adding the app_code folder" width="616" height="283" class="alignnone size-full wp-image-1430" /></div>

<p>Right click the new <code>App_Code</code> folder and click "Add New Item". Add a class and name the file BasePage.cs.</p>

<h3>Extending The System.Web.UI.Page Class</h3>
<p>The idea here is to have our <code>BasePage</code> extend <code>System.Web.UI.Page</code> so that our pages don't have to. We will start out with nothing and build on it as we need to share more functionality. For now take a look at how this extension is accomplished:</p>

<div class="highlight"><pre><code class="csharp"><span class="lineno">1</span> <span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="lineno">2</span> <span class="k">using</span> <span class="nn">System.Web</span><span class="p">;</span>
<span class="lineno">3</span> <span class="k">public</span> <span class="k">class</span> <span class="nc">BasePage</span> <span class="p">:</span> <span class="n">System</span><span class="p">.</span><span class="n">Web</span><span class="p">.</span><span class="n">UI</span><span class="p">.</span><span class="n">Page</span>
<span class="lineno">4</span> <span class="p">{</span>
<span class="lineno">5</span>     <span class="k">public</span> <span class="nf">BasePage</span><span class="p">()</span>
<span class="lineno">6</span>     <span class="p">{</span>
<span class="lineno">7</span>     <span class="p">}</span>
<span class="lineno">8</span> <span class="p">}</span>
</code></pre>
</div>


<p>Voila! Our BasePage is created. For now we just have an empty constructor, but we will build on this. Our pages can now inherit from this instead of the typical <code>System.Web.UI.Page</code> class.</p>

<h2>Creating a Consistent Layout With Master Pages</h2>
<p>If you want to create a consistent layout for your web forms, then you will definitely need a master page or two. You can place site wide styles and controls in these bad boys.</p>
<p>
Master pages are a lot like aspx pages in that they can contain server controls and they also have their own code-behind file. The key player in a master page is the <code>ContentPlaceHolder</code> control. This guy does exactly what it's name implies; it acts as a placeholder for content. I created a directory in the solution called "MasterPages" to place my master pages. Here is the master page "Layout.master" that will be used for the remainder:</p>

<div class="highlight"><pre><code class="html"><span class="lineno"> 1</span> <span class="err">&lt;</span>%@ Master Language=&quot;C#&quot; EnableViewState=&quot;true&quot; ViewStateMode=&quot;Disabled&quot; AutoEventWireup=&quot;true&quot; CodeFile=&quot;Layout.master.cs&quot; Inherits=&quot;MasterPages_Layout&quot; %&gt;
<span class="lineno"> 2</span> 
<span class="lineno"> 3</span> <span class="cp">&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot; &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt;</span>
<span class="lineno"> 4</span> 
<span class="lineno"> 5</span> <span class="nt">&lt;html</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.w3.org/1999/xhtml&quot;</span><span class="nt">&gt;</span>
<span class="lineno"> 6</span> <span class="nt">&lt;head</span> <span class="na">runat=</span><span class="s">&quot;server&quot;</span><span class="nt">&gt;</span>
<span class="lineno"> 7</span>     <span class="nt">&lt;title&gt;&lt;/title&gt;</span>
<span class="lineno"> 8</span>     <span class="nt">&lt;asp:ContentPlaceHolder</span> <span class="na">id=</span><span class="s">&quot;head&quot;</span> <span class="na">runat=</span><span class="s">&quot;server&quot;</span><span class="nt">&gt;</span>
<span class="lineno"> 9</span>     <span class="nt">&lt;/asp:ContentPlaceHolder&gt;</span>
<span class="lineno">10</span>     <span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">&quot;../styles.css&quot;</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">type=</span><span class="s">&quot;text/css&quot;</span> <span class="nt">/&gt;</span>
<span class="lineno">11</span> <span class="nt">&lt;/head&gt;</span>
<span class="lineno">12</span> <span class="nt">&lt;body&gt;</span>
<span class="lineno">13</span>     <span class="nt">&lt;form</span> <span class="na">id=</span><span class="s">&quot;form1&quot;</span> <span class="na">runat=</span><span class="s">&quot;server&quot;</span><span class="nt">&gt;</span>
<span class="lineno">14</span>     <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;topHat&quot;</span> <span class="na">class=</span><span class="s">&quot;add-bottom&quot;</span><span class="nt">&gt;</span>
<span class="lineno">15</span>         <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;wrapper clearfix&quot;</span><span class="nt">&gt;</span>
<span class="lineno">16</span>             <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;alignleft&quot;</span><span class="nt">&gt;</span>
<span class="lineno">17</span>                 <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;Default.aspx&quot;</span><span class="nt">&gt;</span>Home<span class="nt">&lt;/a&gt;</span>
<span class="lineno">18</span>             <span class="nt">&lt;/div&gt;</span>
<span class="lineno">19</span>             <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;alignright&quot;</span><span class="nt">&gt;</span>
<span class="lineno">20</span>                 <span class="nt">&lt;asp:Label</span> <span class="na">AssociatedControlID=</span><span class="s">&quot;ddlThemes&quot;</span> <span class="na">ID=</span><span class="s">&quot;lblThemes&quot;</span> <span class="na">runat=</span><span class="s">&quot;server&quot;</span> <span class="na">EnableTheming=</span><span class="s">&quot;false&quot;</span> <span class="na">Text=</span><span class="s">&quot;Choose Theme: &quot;</span><span class="nt">&gt;&lt;/asp:Label&gt;</span>
<span class="lineno">21</span>                 <span class="nt">&lt;asp:DropDownList</span> <span class="na">ID=</span><span class="s">&quot;ddlThemes&quot;</span> <span class="na">runat=</span><span class="s">&quot;server&quot;</span> <span class="na">AutoPostBack=</span><span class="s">&quot;true&quot;</span> 
<span class="lineno">22</span>                     <span class="na">onselectedindexchanged=</span><span class="s">&quot;ddlThemes_SelectedIndexChanged&quot;</span> <span class="na">ViewStateMode=</span><span class="s">&quot;Enabled&quot;</span> <span class="na">EnableTheming=</span><span class="s">&quot;false&quot;</span><span class="nt">&gt;</span>
<span class="lineno">23</span>                     <span class="nt">&lt;asp:ListItem&gt;</span>Grid<span class="nt">&lt;/asp:ListItem&gt;</span>
<span class="lineno">24</span>                     <span class="nt">&lt;asp:ListItem&gt;</span>Midnight<span class="nt">&lt;/asp:ListItem&gt;</span>
<span class="lineno">25</span>                 <span class="nt">&lt;/asp:DropDownList&gt;</span>
<span class="lineno">26</span>             <span class="nt">&lt;/div&gt;</span>
<span class="lineno">27</span>         <span class="nt">&lt;/div&gt;</span>
<span class="lineno">28</span>     <span class="nt">&lt;/div&gt;</span>
<span class="lineno">29</span>     <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;wrapper&quot;</span><span class="nt">&gt;</span>
<span class="lineno">30</span>         <span class="nt">&lt;asp:ContentPlaceHolder</span> <span class="na">id=</span><span class="s">&quot;ContentForLayout&quot;</span> <span class="na">runat=</span><span class="s">&quot;server&quot;</span><span class="nt">&gt;</span>
<span class="lineno">31</span>         
<span class="lineno">32</span>         <span class="nt">&lt;/asp:ContentPlaceHolder&gt;</span>
<span class="lineno">33</span>     <span class="nt">&lt;/div&gt;</span>
<span class="lineno">34</span>     <span class="nt">&lt;/form&gt;</span>
<span class="lineno">35</span> <span class="nt">&lt;/body&gt;</span>
<span class="lineno">36</span> <span class="nt">&lt;/html&gt;</span>
</code></pre>
</div>


<p>As you can see, things look pretty similar to a web form. You will notice that instead of the &lt;@Page&gt; directive, there is a &lt;@Master&gt; directive.</p>

<h3>Using Master Pages In Web Forms</h3>
<p>It is super easy to use a master page in web forms. In the Default.aspx file , you just need to reference the Master Page via the <code>MasterPageFile</code> property of the <@ Page > directive. If your web form is in the root of your web site, and the master page is in the MasterPages directory, the directive will look like the following:</p>

<div class="highlight"><pre><code class="html"><span class="lineno">1</span> <span class="err">&lt;</span>%@ Page Language=&quot;C#&quot; MasterPageFile=&quot;~/MasterPages/Layout.master&quot; AutoEventWireup=&quot;true&quot; CodeFile=&quot;Default.aspx.cs&quot; Inherits=&quot;_Default&quot; %&gt;
</code></pre>
</div>

<p>The next step is to make sure that the content from your web form ends up in the placeholder of the master page. This is accomplished with the <code>Content</code> control. Simply wrap the content of your web form in the .aspx file in this control:</p>

<div class="highlight"><pre><code class="html"><span class="lineno">1</span> <span class="nt">&lt;asp:Content</span> <span class="na">runat=</span><span class="s">&quot;server&quot;</span> <span class="na">ContentPlaceHolderID=</span><span class="s">&quot;ContentForLayout&quot;</span><span class="nt">&gt;</span>
<span class="lineno">2</span>     <span class="c">&lt;!-- web form content here --&gt;</span>
<span class="lineno">3</span> <span class="nt">&lt;/asp:Content&gt;</span>
</code></pre>
</div>

<p>The thing to notice here is that the <code>Content</code> control has a property called <code>ContentPlaceHolderID</code> that refers to the <code>ID</code> property of our master page's <code>ContentPlaceHolder</code> control. This is how the ASP.NET run time knows to place the web form's content inside the master page.</p>

<h2>Creating a Consistent Look With Themes</h2>
<p>We have consistent functionality, consistent layout, and now we need a way to have a consistent style for our application. This is accomplished with Themes. Much like adding the App_Code directory, if you don't have an App_Theme folder already, right click the project name in the solution explorer and follow <code>Add ASP.NET Folder > Theme</code>.</p>
<div class="post-image">
     <img src="/images/themes.jpg" alt="adding themes to an ASP.NET project" title="adding themes to an ASP.NET project" width="630" height="265" class="bordered" />
 </div> 

 <p>Name your theme what ever you want. I did this twice and created two different themes, one called "Midnight" and one called "Grid"</p>

<h3>Theme CSS</h3>
<p>After creating a theme, you should add the necessary style sheet(s) to the theme folder (right click > Add New Item > Style Sheet). It is good practice to name the style sheet after the theme, so if my theme is called "Grid", then I should add a style sheet named Grid.css. It is also a good idea to add an images folder for your style sheet to reference if it makes use of background images.</p>

<h3>Skins</h3>
<p>Another key component of themes is the skin. Skins are files that end in the .skin extension and they are used to "skin" or style controls types in your project. If we want to add a CssClass to every button in our project and style it accordingly in the theme style sheet we would "right click Add New Item" a skin file, and name it something appropriate - say Button.skin. In the skin file we place the control to skin in a web form or master page - much like we would in a web form - only we leave out the <code>ID</code> property.</p>

<div class="highlight"><pre><code class="html"><span class="lineno">1</span> <span class="nt">&lt;asp:Button</span> <span class="na">runat=</span><span class="s">&quot;server&quot;</span> <span class="na">CssClass=</span><span class="s">&quot;pizza-button&quot;</span> <span class="nt">/&gt;</span>
</code></pre>
</div>


<p>There are more properties you can add in the skin file, but the <code>CssClass</code> property is the most useful as far as consistent aesthetics go for a type of control. Essentially any property supported by skins that is added to this skin file, will be reflected in all the <code>Button</code> controls that show up in your application.</p>

<p>After adding a style sheet, an images directory , and a few skins to my "Grid" theme, my directory structure resembles the following:</p>

<div class="post-image">
    <img src="/images/skin-added.jpg" alt="directory structure" title="directory structure" width="286" height="352" />
</div>

<h2>Making a Theme Switcher</h2>
<p>Let's put this all together to make a global theme switcher. I have created two themes for my application, one called "Grid" and the other called "Midnight". I want to create a simple way for users to select their preferred theme, and have that theme be selected on their next visit. We are going to combine what we know about base pages, master pages, and themes to accomplish this task.</p>

<h3>Adding The Theme Drop Down</h3>
<p>The first thing we need to do is add a way for our users to select their theme. The best candidate for the job is a <code>DropDownList</code> control. Since this <code>DropDownList</code> needs to be available on every page, we will add this control to our master page. Right under the opening form tag in our master page, we will add this control with some attributes for the CSS and a couple of control properties. I will add <code>ListItem</code> controls for the two available themes.</p>

<div class="highlight"><pre><code class="html"><span class="lineno"> 1</span> <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;topHat&quot;</span> <span class="na">class=</span><span class="s">&quot;add-bottom&quot;</span><span class="nt">&gt;</span>
<span class="lineno"> 2</span>     <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;wrapper clearfix&quot;</span><span class="nt">&gt;</span>
<span class="lineno"> 3</span>         <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;alignleft&quot;</span><span class="nt">&gt;</span>
<span class="lineno"> 4</span>             <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;Default.aspx&quot;</span><span class="nt">&gt;</span>Home<span class="nt">&lt;/a&gt;</span>
<span class="lineno"> 5</span>         <span class="nt">&lt;/div&gt;</span>
<span class="lineno"> 6</span>         <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;alignright&quot;</span><span class="nt">&gt;</span>
<span class="lineno"> 7</span>             <span class="nt">&lt;asp:Label</span> <span class="na">AssociatedControlID=</span><span class="s">&quot;ddlThemes&quot;</span> <span class="na">ID=</span><span class="s">&quot;lblThemes&quot;</span> <span class="na">runat=</span><span class="s">&quot;server&quot;</span> <span class="na">EnableTheming=</span><span class="s">&quot;false&quot;</span> <span class="na">Text=</span><span class="s">&quot;Choose Theme: &quot;</span><span class="nt">&gt;&lt;/asp:Label&gt;</span>
<span class="lineno"> 8</span>             <span class="nt">&lt;asp:DropDownList</span> <span class="na">ID=</span><span class="s">&quot;ddlThemes&quot;</span> <span class="na">runat=</span><span class="s">&quot;server&quot;</span> <span class="na">AutoPostBack=</span><span class="s">&quot;true&quot;</span> 
<span class="lineno"> 9</span>                 <span class="na">onselectedindexchanged=</span><span class="s">&quot;ddlThemes_SelectedIndexChanged&quot;</span> <span class="na">ViewStateMode=</span><span class="s">&quot;Enabled&quot;</span> <span class="na">EnableTheming=</span><span class="s">&quot;false&quot;</span><span class="nt">&gt;</span>
<span class="lineno">10</span>                 <span class="nt">&lt;asp:ListItem&gt;</span>Grid<span class="nt">&lt;/asp:ListItem&gt;</span>
<span class="lineno">11</span>                 <span class="nt">&lt;asp:ListItem&gt;</span>Midnight<span class="nt">&lt;/asp:ListItem&gt;</span>
<span class="lineno">12</span>             <span class="nt">&lt;/asp:DropDownList&gt;</span>
<span class="lineno">13</span>         <span class="nt">&lt;/div&gt;</span>
<span class="lineno">14</span>     <span class="nt">&lt;/div&gt;</span>
<span class="lineno">15</span> <span class="nt">&lt;/div&gt;</span>
</code></pre>
</div>


<p>Notice the properties used in our two controls. The <code>Label</code> and the <code>DropDownList</code> both have a property <code>EnableThemeing</code> set to false. Since these are controls that will be present on all pages, we don't want the theme to control how they look.</p>

<p>The <code>DropDownList</code> sets the <code>AutoPostBack</code> property to true in order to wire up a little JavaScript that will submit the form automatically when the value changes.</p>

<p>If you look at the &lt;%@Master&gt; directive in our master page, you will see that by default we disable view state. This is a performance consideration, but we do want our theme switcher to track it's state, so we set the <code>DropDownList</code> property <code>ViewStateMode</code> to true.</p>

<p>I use the global style sheet (styles.css) that I added to the <code>head</code> element of the master page to style this top section, and this is what I end up with:</p>

<div class="post-image">
    <img src="/images/dropdown.jpg" alt="theme drop down" title="theme drop down" width="589" height="51" />
</div>

<h3>Handling The Drop Down Event</h3>
<p>Remember we set the <code>AutoPostBack</code> property to true, so whenever the value of our control changes, we need some code to handle that event. Since master pages have code-behinds of their own, this is the place to do it. Notice our <code>DropDownList</code> control has an <code>onselectedindexchanged</code> property set to the method <code>ddlThemes_SelectedIndexChanged</code>. We head to the "Layout.master.cs" file and add the following method:</p>

<div class="highlight"><pre><code class="csharp"><span class="lineno"> 1</span> <span class="k">protected</span> <span class="k">void</span> <span class="nf">ddlThemes_SelectedIndexChanged</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">EventArgs</span> <span class="n">e</span><span class="p">)</span>
<span class="lineno"> 2</span> <span class="p">{</span>
<span class="lineno"> 3</span>     <span class="n">HttpCookie</span> <span class="n">userTheme</span> <span class="p">=</span> <span class="k">new</span> <span class="n">HttpCookie</span><span class="p">(</span><span class="s">&quot;UserTheme&quot;</span><span class="p">)</span>
<span class="lineno"> 4</span>     <span class="p">{</span>
<span class="lineno"> 5</span>         <span class="n">Expires</span> <span class="p">=</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">Now</span><span class="p">.</span><span class="n">AddMonths</span><span class="p">(</span><span class="m">3</span><span class="p">),</span>
<span class="lineno"> 6</span>         <span class="n">Value</span> <span class="p">=</span> <span class="n">ddlThemes</span><span class="p">.</span><span class="n">SelectedValue</span>
<span class="lineno"> 7</span>     <span class="p">};</span>
<span class="lineno"> 8</span>     <span class="n">Response</span><span class="p">.</span><span class="n">Cookies</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">userTheme</span><span class="p">);</span>
<span class="lineno"> 9</span>     <span class="n">Response</span><span class="p">.</span><span class="n">Redirect</span><span class="p">(</span><span class="n">Request</span><span class="p">.</span><span class="n">Url</span><span class="p">.</span><span class="n">ToString</span><span class="p">());</span>
<span class="lineno">10</span> <span class="p">}</span>
</code></pre>
</div>


<p>The purpose of this method is to take the selected value from the themes list and store it in a cookie. As you can see this cookie is set to expire in 3 months. After the cookie has been added to the <code>Response.Cookies</code> collection, we redirect the user to the URL where the post happened (this will server the purpose of "refreshing" the theme).</p>

<p>In addition to this method that handles the <code>DropDownList</code> changing values, it would be nice to make sure the control is loaded with the correct theme already selected in the control. We will do this on every page when it loads with the <code>Load</code> event. This is as easy adding some logic to the <code>Page_Load</code> method.</p>

<div class="highlight"><pre><code class="csharp"><span class="lineno"> 1</span> <span class="k">protected</span> <span class="k">void</span> <span class="nf">Page_Load</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">EventArgs</span> <span class="n">e</span><span class="p">)</span>
<span class="lineno"> 2</span> <span class="p">{</span>
<span class="lineno"> 3</span>     <span class="k">if</span> <span class="p">(!</span><span class="n">Page</span><span class="p">.</span><span class="n">IsPostBack</span><span class="p">)</span>
<span class="lineno"> 4</span>     <span class="p">{</span>
<span class="lineno"> 5</span>         <span class="kt">string</span> <span class="n">selectedTheme</span> <span class="p">=</span> <span class="n">Page</span><span class="p">.</span><span class="n">Theme</span><span class="p">;</span>
<span class="lineno"> 6</span>         <span class="n">HttpCookie</span> <span class="n">userTheme</span> <span class="p">=</span> <span class="n">Request</span><span class="p">.</span><span class="n">Cookies</span><span class="p">.</span><span class="n">Get</span><span class="p">(</span><span class="s">&quot;UserTheme&quot;</span><span class="p">);</span>
<span class="lineno"> 7</span>         <span class="k">if</span> <span class="p">(</span><span class="n">userTheme</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
<span class="lineno"> 8</span>         <span class="p">{</span>
<span class="lineno"> 9</span>             <span class="n">selectedTheme</span> <span class="p">=</span> <span class="n">userTheme</span><span class="p">.</span><span class="n">Value</span><span class="p">;</span>
<span class="lineno">10</span>         <span class="p">}</span>
<span class="lineno">11</span>         <span class="k">if</span> <span class="p">(!</span><span class="kt">string</span><span class="p">.</span><span class="n">IsNullOrEmpty</span><span class="p">(</span><span class="n">selectedTheme</span><span class="p">)</span> <span class="p">&amp;&amp;</span> <span class="n">ddlThemes</span><span class="p">.</span><span class="n">Items</span><span class="p">.</span><span class="n">FindByValue</span><span class="p">(</span><span class="n">selectedTheme</span><span class="p">)</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
<span class="lineno">12</span>         <span class="p">{</span>
<span class="lineno">13</span>             <span class="n">ddlThemes</span><span class="p">.</span><span class="n">Items</span><span class="p">.</span><span class="n">FindByValue</span><span class="p">(</span><span class="n">selectedTheme</span><span class="p">).</span><span class="n">Selected</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
<span class="lineno">14</span>         <span class="p">}</span>
<span class="lineno">15</span>     <span class="p">}</span>
<span class="lineno">16</span> <span class="p">}</span>
</code></pre>
</div>


<p>First we make sure the page load does not come after a POST request. We use the default theme set for our pages (set in the web.config specifically) as our initial value for the selected theme. We then check to see if a cookie exists for the user's preferred theme, and if it does we make sure there is a corresponding value in the <code>DropDownList</code>. If everything checks out, the <code>DropDownList</code> will have the user's preferred theme already selected in the <code>DropDownList</code> control.</p>

<h3>Using The Base Page To Display The Theme</h3>
<p>We need to make sure the theme is loaded on every page. The best way to do this is through our <code>BasePage</code> class we created earlier. We will define some methods and make sure they get added as event handlers to every page that inherits from <code>BasePage</code>. Let's open BasePage.cs and get to work.</p>

<h3>Loading The Selected Theme</h3>
<p>Every page needs to load the theme that has been selected. Themes need to be set early in the ASP.NET page life cycle. The place to do it is the <code>PreInit</code> event. We need to define a method that will check the cookie we set in our master page code-behind and set the current page theme to that selected theme if it exists.</p>

<div class="highlight"><pre><code class="csharp"><span class="lineno"> 1</span> <span class="k">private</span> <span class="k">void</span> <span class="nf">Page_PreInit</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">EventArgs</span> <span class="n">e</span><span class="p">)</span>
<span class="lineno"> 2</span> <span class="p">{</span>
<span class="lineno"> 3</span>     <span class="n">HttpCookie</span> <span class="n">userTheme</span> <span class="p">=</span> <span class="n">Request</span><span class="p">.</span><span class="n">Cookies</span><span class="p">.</span><span class="n">Get</span><span class="p">(</span><span class="s">&quot;UserTheme&quot;</span><span class="p">);</span>
<span class="lineno"> 4</span>     <span class="k">if</span> <span class="p">(</span><span class="n">userTheme</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
<span class="lineno"> 5</span>     <span class="p">{</span>
<span class="lineno"> 6</span>         <span class="kt">string</span> <span class="n">themePath</span> <span class="p">=</span> <span class="n">Request</span><span class="p">.</span><span class="n">PhysicalApplicationPath</span> <span class="p">+</span> <span class="s">&quot;App_Themes&quot;</span> <span class="p">+</span> <span class="sc">&#39;\\&#39;</span> <span class="p">+</span> <span class="n">userTheme</span><span class="p">.</span><span class="n">Value</span><span class="p">;</span>
<span class="lineno"> 7</span>         <span class="k">if</span> <span class="p">(</span><span class="n">Directory</span><span class="p">.</span><span class="n">Exists</span><span class="p">(</span><span class="n">themePath</span><span class="p">))</span>
<span class="lineno"> 8</span>         <span class="p">{</span>
<span class="lineno"> 9</span>             <span class="n">Page</span><span class="p">.</span><span class="n">Theme</span> <span class="p">=</span> <span class="n">userTheme</span><span class="p">.</span><span class="n">Value</span><span class="p">;</span>
<span class="lineno">10</span>         <span class="p">}</span>
<span class="lineno">11</span>     <span class="p">}</span>
<span class="lineno">12</span> <span class="p">}</span>
</code></pre>
</div>


<p>First we see if the cookie exists. If it does we use a little <code>System.IO</code> to verify that the theme directory exists. If it does we set the <code>Page.Theme</code> property to the selected theme.</p>

<p>We wire up the event in our <code>BasePage</code> constructor.</p>

<div class="highlight"><pre><code class="csharp"><span class="lineno">1</span> <span class="k">public</span> <span class="nf">BasePage</span><span class="p">()</span>
<span class="lineno">2</span> <span class="p">{</span>
<span class="lineno">3</span>     <span class="c1">//append our Page_PreInit method to the list of handlers</span>
<span class="lineno">4</span>     <span class="k">this</span><span class="p">.</span><span class="n">PreInit</span> <span class="p">+=</span> <span class="k">new</span> <span class="n">EventHandler</span><span class="p">(</span><span class="n">Page_PreInit</span><span class="p">);</span>
<span class="lineno">5</span> <span class="p">}</span>
</code></pre>
</div>


<h3>Loading Google Web Fonts</h3>
<p>I wanted to use some Google Web Fonts in my application, so I have opted to do it in the <code>BasePage</code> class depending on the current theme. This is done during the <code>Load</code> of the page.</p>

<div class="highlight"><pre><code class="csharp"><span class="lineno"> 1</span> <span class="k">private</span> <span class="k">void</span> <span class="nf">Page_Load</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">EventArgs</span> <span class="n">e</span><span class="p">)</span>
<span class="lineno"> 2</span> <span class="p">{</span>
<span class="lineno"> 3</span>     <span class="c1">//the theme was set before this in PreInit</span>
<span class="lineno"> 4</span>     <span class="kt">string</span> <span class="n">selectedTheme</span> <span class="p">=</span> <span class="n">Page</span><span class="p">.</span><span class="n">Theme</span><span class="p">;</span>
<span class="lineno"> 5</span>     <span class="k">if</span> <span class="p">(!</span><span class="kt">string</span><span class="p">.</span><span class="n">IsNullOrEmpty</span><span class="p">(</span><span class="n">selectedTheme</span><span class="p">))</span>
<span class="lineno"> 6</span>     <span class="p">{</span>
<span class="lineno"> 7</span>         <span class="k">switch</span> <span class="p">(</span><span class="n">selectedTheme</span><span class="p">)</span>
<span class="lineno"> 8</span>         <span class="p">{</span>
<span class="lineno"> 9</span>             <span class="k">case</span> <span class="s">&quot;Grid&quot;</span><span class="p">:</span>
<span class="lineno">10</span>                 <span class="n">AddStyleSheet</span><span class="p">(</span><span class="s">&quot;http://fonts.googleapis.com/css?family=Droid+Sans|Lobster&quot;</span><span class="p">);</span>
<span class="lineno">11</span>                 <span class="k">break</span><span class="p">;</span>
<span class="lineno">12</span>             <span class="k">case</span> <span class="s">&quot;Midnight&quot;</span><span class="p">:</span>
<span class="lineno">13</span>                 <span class="n">AddStyleSheet</span><span class="p">(</span><span class="s">&quot;http://fonts.googleapis.com/css?family=Open+Sans|Oswald&quot;</span><span class="p">);</span>
<span class="lineno">14</span>                 <span class="k">break</span><span class="p">;</span>
<span class="lineno">15</span>         <span class="p">}</span>
<span class="lineno">16</span>     <span class="p">}</span>
<span class="lineno">17</span> <span class="p">}</span>
</code></pre>
</div>


<p><code>AddStyleSheet</code> is a helper method used to dynamically add style sheets to the <code>Header</code> object.</p>

<div class="highlight"><pre><code class="csharp"><span class="lineno">1</span> <span class="k">private</span> <span class="k">void</span> <span class="nf">AddStyleSheet</span><span class="p">(</span><span class="kt">string</span> <span class="n">href</span><span class="p">)</span>
<span class="lineno">2</span> <span class="p">{</span>
<span class="lineno">3</span>     <span class="n">HtmlLink</span> <span class="n">link</span> <span class="p">=</span> <span class="k">new</span> <span class="n">HtmlLink</span><span class="p">();</span>
<span class="lineno">4</span>     <span class="n">link</span><span class="p">.</span><span class="n">Attributes</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="s">&quot;rel&quot;</span><span class="p">,</span> <span class="s">&quot;stylesheet&quot;</span><span class="p">);</span>
<span class="lineno">5</span>     <span class="n">link</span><span class="p">.</span><span class="n">Attributes</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="s">&quot;media&quot;</span><span class="p">,</span> <span class="s">&quot;all&quot;</span><span class="p">);</span>
<span class="lineno">6</span>     <span class="n">link</span><span class="p">.</span><span class="n">Attributes</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="s">&quot;href&quot;</span><span class="p">,</span> <span class="n">href</span><span class="p">);</span>
<span class="lineno">7</span>     <span class="n">link</span><span class="p">.</span><span class="n">Attributes</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="s">&quot;type&quot;</span><span class="p">,</span> <span class="s">&quot;text/css&quot;</span><span class="p">);</span>
<span class="lineno">8</span>     <span class="n">Header</span><span class="p">.</span><span class="n">Controls</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">link</span><span class="p">);</span>
<span class="lineno">9</span> <span class="p">}</span>
</code></pre>
</div>


<p>As with our <code>Page_PreInit</code> method, we need to add our <code>Page_Load</code> method to the list of <code>Load</code> event handlers. This is done in the constructor as well.</p>

<div class="highlight"><pre><code class="csharp"><span class="lineno">1</span> <span class="k">public</span> <span class="nf">BasePage</span><span class="p">()</span>
<span class="lineno">2</span> <span class="p">{</span>
<span class="lineno">3</span>     <span class="k">this</span><span class="p">.</span><span class="n">Load</span> <span class="p">+=</span> <span class="k">new</span> <span class="n">EventHandler</span><span class="p">(</span><span class="n">Page_Load</span><span class="p">);</span>
<span class="lineno">4</span>     <span class="k">this</span><span class="p">.</span><span class="n">PreInit</span> <span class="p">+=</span> <span class="k">new</span> <span class="n">EventHandler</span><span class="p">(</span><span class="n">Page_PreInit</span><span class="p">);</span>
<span class="lineno">5</span> <span class="p">}</span>
</code></pre>
</div>


<h3>Extending The Base Page</h3>
<p>
    To make sure our pages are taking advantage of this functionality, we need to make sure the code-behind class is extending our <code>BasePage</code> instead of <code>System.Web.UI.Page</code>
</p>

<div class="highlight"><pre><code class="csharp"><span class="lineno"> 1</span> <span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="lineno"> 2</span> <span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="lineno"> 3</span> <span class="k">using</span> <span class="nn">System.Linq</span><span class="p">;</span>
<span class="lineno"> 4</span> <span class="k">using</span> <span class="nn">System.Web</span><span class="p">;</span>
<span class="lineno"> 5</span> <span class="k">using</span> <span class="nn">System.Web.UI</span><span class="p">;</span>
<span class="lineno"> 6</span> <span class="k">using</span> <span class="nn">System.Web.UI.WebControls</span><span class="p">;</span>
<span class="lineno"> 7</span> 
<span class="lineno"> 8</span> <span class="k">public</span> <span class="k">partial</span> <span class="k">class</span> <span class="nc">_Default</span> <span class="p">:</span> <span class="n">BasePage</span>
<span class="lineno"> 9</span> <span class="p">{</span>
<span class="lineno">10</span>     <span class="c1">//page code</span>
<span class="lineno">11</span> <span class="p">}</span>
</code></pre>
</div>


<h3>Voila!</h3>
<p>Our theme switcher is now complete. We can now switch between our two themes with ease!</p>

<div class="columns five">
<img src="/images/grid-300x285.png" alt="grid theme" title="grid theme" width="300" height="285" />
</div>
<div class="columns five">
<img src="/images/midnight-235x300.png" alt="midnight theme" title="midnight theme" width="235" height="300" />
</div>

<p style="clear:both;">
Don't forget to download the source!
</p>
<a class="button add-bottom" href="/downloads/pizzagreeta.zip" title="download source">Download Source</a>

		</article>
		<div id="disqus_thread"></div>
		<script type="text/javascript">
		    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
		    var disqus_shortname = 'brianscaturro'; // required: replace example with your forum shortname

		    /* * * DON'T EDIT BELOW THIS LINE * * */
		    (function() {
		        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
		        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
		    })();
		</script>
		<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
		<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
	</div>
</div>
<aside class="four columns omega offset-by-one" id="sidebar">
	<img class="add-bottom photo" src="/images/steed.jpg" alt="some of my best thinking occurs on unicorns">
	<h2>Recent Posts</h2>
	<ul class='posts'>
		
		<li><h3><a href="/2012/05/21/domain-driven-php.html">Domain Driven PHP</a></h3></li>
		
		<li><h3><a href="/2012/04/27/is-agile-dead.html">Is Agile Dead?</a></h3></li>
		
		<li><h3><a href="/2012/03/27/tdd-with-mock-objects-and-phpunit.html">TDD With Mock Objects And PHPUnit</a></h3></li>
		
		<li><h3><a href="/2012/03/10/javascript-masterclass-review.html">JavaScript Masterclass With Thomas Fuchs and Amy Hoy: A Review</a></h3></li>
		
		<li><h3><a href="/">The rest....</a></h3></li>
	</ul>
</aside>
		<div class="sixteen columns alpha omega">
			<footer>
				&copy; 2012 Brian Scaturro - <a href="http://feeds.feedburner.com/brianscaturro" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a>&nbsp;<a id="subscribe-link" href="http://feeds.feedburner.com/brianscaturro" rel="alternate" type="application/rss+xml">subscribe</a>
			</footer>
		</div>
	</div>
</body>
</html>
